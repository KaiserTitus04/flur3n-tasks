<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>FLUR 3N – Weekly Tasks</title>
<style>
body{font-family:system-ui,Arial,sans-serif;margin:1.5rem}
h1{text-align:center;margin-bottom:1rem}

.wrap{overflow-x:auto;border:1px solid #666;border-radius:4px}
table{border-collapse:collapse;border:1px solid #666;min-width:980px}
th,td{border:1px solid #666;padding:.35rem .5rem}
th{background:#f5f5f5;font-weight:600;text-align:center;position:sticky;top:0}
td.task{width:340px;white-space:pre-wrap;text-align:left}
td.person{width:55px;text-align:center}
.tick{color:#0a0;font-size:1.1rem}
.cross{color:#a00;font-size:1.1rem}
</style>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest"></script>
<script>
fetch('WeeklyPlans/Tasks_latest.xlsx')
  .then(r => r.arrayBuffer())
  .then(buf => {
    const wb = XLSX.read(buf,{type:'array'});
    const ws = wb.Sheets[wb.SheetNames[0]];

    // 1) komplettes Sheet → Array ab Zeile 4
    let rows = XLSX.utils.sheet_to_json(ws,{header:1,range:3});

    // 2) Spaltenbreite dynamisch: letzte Zelle in Kopfzeile suchen
    const head = rows.shift();
    const lastCol = head.map((v,i)=>[v,i]).filter(([v])=>v!==undefined).pop()[1];
    head.length = lastCol+1;                   // kappe rechts leere Header‑Zellen
    rows = rows.map(r => { r.length = lastCol+1; return r; });

    // 3) Task‑Zeilen begrenzen: alles nach erster völlig leeren Zeile verwerfen
    const firstEmpty = rows.findIndex(r => r.slice(0,lastCol+1).every(c=>c===undefined));
    if(firstEmpty !== -1) rows = rows.slice(0, firstEmpty);

    // 4) Tabelle erzeugen
    const tbl = document.getElementById('tasks');
    tbl.innerHTML =
      '<thead><tr>'+head.map((c,i)=>`<th>${i===0?"Task / Description":c||""}</th>`).join('')+'</tr></thead>';

    const body = rows.map(r=>{
      return '<tr>'+r.map((c,i)=>{
        if(i===0) return `<td class="task">${c||""}</td>`;
        if(c==='✓')     return '<td class="tick">✓</td>';
        if((c||"").toString().toUpperCase()==='X') return '<td class="cross">❌</td>';
        return '<td class="person"></td>';
      }).join('')+'</tr>';
    }).join('');

    tbl.innerHTML += `<tbody>${body}</tbody>`;
    new simpleDatatables.DataTable(tbl,{searchable:false,paging:false,fixedHeight:true});
  });
</script>

</body>
</html>
