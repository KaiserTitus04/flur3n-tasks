<!doctype html>
<html><head>
<meta charset="utf-8"><title>FLUR 3N – Report Task</title>
<style>
body{font-family:system-ui,Arial;padding:1.6rem;max-width:500px;margin:auto}
label{display:block;margin:.8rem 0 .2rem}
button{margin-top:1.2rem;padding:.4rem 1rem}
</style>
</head><body>
<h2>Task erledigt? – kurz eintragen:</h2>

<label>Name:
  <input id="name" required>
</label>

<label>Task diese Woche:
  <select id="task"></select>
</label>

<label>Kommentar (optional):
  <input id="comment">
</label>

<button onclick="submit()">✓ Eintragen</button>
<p id="msg"></p>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
const SHEET_API = 'https://script.google.com/macros/s/AKfycbwvVTEA2W2ECiEINGi6frRuLI_oun157C-0VmC5IX8EIsUi82n_INf1cb9H2zCxezkp/exec';
const KEY       = 'YOUR_SUPER_SECRET_KEY';
const PLAN_XLSX = 'WeeklyPlans/Tasks_latest.xlsx';

/* --- 1 | Dropdown füllen ------------------------------------------------ */
fetch(PLAN_XLSX).then(r=>r.arrayBuffer()).then(buf=>{
  const ws=XLSX.read(buf,{type:'array'}).Sheets.Sheet1;
  const arr=XLSX.utils.sheet_to_json(ws,{header:1,range:3});
  const sel=document.getElementById('task');
  arr.forEach(r=>r[0] && sel.insertAdjacentHTML('beforeend',`<option>${r[0]}</option>`));
});

/* --- 2 | Formular absenden --------------------------------------------- */
function submit(){
  const n=$('#name'), t=$('#task'), c=$('#comment'), m=$('#msg');
  if(!n.value.trim()){m.textContent='Name fehlt';return;}
  fetch(SHEET_API+'?'+new URLSearchParams({
      key:KEY, person:n.value.trim(), task:t.value, comment:c.value.trim()
  }),{method:'POST'}).then(r=>r.text()).then(txt=>{
      m.textContent = txt==='ok' ? '✓ gespeichert, danke!' : 'Fehler: '+txt;
      c.value='';
  });
}
function $(q){return document.querySelector(q);}
</script>
</body></html>
